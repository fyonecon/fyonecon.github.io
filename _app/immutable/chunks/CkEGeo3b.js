import{w as W,af as J,aW as X,aX as G,a8 as K,a9 as Y,a1 as Z,x as g,$ as H,aP as L,aV as V,aa as Q,aY as I,a0 as U,ab as tt}from"./CMcf4bXL.js";import{B as et}from"./D-VcpiYR.js";import{m as nt,i as rt,a as w,b as st,e as ot,M as E,t as ct,d as ut,w as D,I as M,g as at,h as it}from"./Bdj0ESLK.js";function wt(t,r,...e){var o=new et(t);W(()=>{const i=r()??null;o.ensure(i,i&&(c=>i(c,...e)))},J)}function Ct(t){const r=Symbol();return{key:r,consume(){return G(r)||t},provide(e){return X(r,e)}}}function ft(t){return new Proxy({},{get(r,e){return e==="style"?o=>t({style:o}).style:t}})}var Et=()=>t=>Array.from(new Set(t));const q={className:"class",defaultChecked:"checked",defaultValue:"value",htmlFor:"for",onBlur:"onfocusout",onChange:"oninput",onFocus:"onfocusin",onDoubleClick:"ondblclick"};function O(t){let r="";for(let e in t){const o=t[e];o!=null&&(e.startsWith("--")||(e=e.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`)),r+=`${e}:${o};`)}return r}const lt=new Set("viewBox,className,preserveAspectRatio,fillRule,clipPath,clipRule,strokeWidth,strokeLinecap,strokeLinejoin,strokeDasharray,strokeDashoffset,strokeMiterlimit".split(","));function gt(t){return t in q?q[t]:lt.has(t)?t:t.toLowerCase()}function dt(t,r){return t==="style"&&typeof r=="object"?O(r):r}const Nt=ft(t=>{const r={};for(const e in t)r[gt(e)]=dt(e,t[e]);return r}),pt=/((?:--)?(?:\w+-?)+)\s*:\s*([^;]*)/g,mt=t=>{const r={};let e;for(;e=pt.exec(t);)r[e[1]]=e[2];return r};function Rt(...t){const r=[];for(const o of t)o&&"class"in o&&o.class!=null&&r.push(o.class);const e=nt(...t);return r.length>0&&(e.class=r.length===1?r[0]:r),"style"in e&&(typeof e.style=="string"&&(e.style=mt(e.style)),e.style=O(e.style)),e}function $(t){const r=t().defaultValue??t().value,e=t().isEqual??Object.is;let o=K(Y(r));const i=V(()=>t().value!==void 0);let c={current:Z(()=>g(o))},p={current:void 0};H(()=>{const a=g(i)?t().value:g(o);c={current:a},p={current:a}});const b=a=>{const d=w(a)?a(c.current):a,y=p.current;t().debug&&console.log(`[bindable > ${t().debug}] setValue`,{next:d,prev:y}),g(i)||Q(o,d,!0),e(d,y)||t().onChange?.(d,y)};function m(){return g(i)?t().value:g(o)}return{initial:r,ref:c,get:m,set(a){(t().sync?L:rt)(()=>b(a))},invoke(a,d){t().onChange?.(a,d)},hash(a){return t().hash?.(a)??String(a)}}}$.cleanup=t=>{I(()=>t())};$.ref=t=>{let r=t;return{get:()=>r,set:e=>{r=e}}};function yt(t){const r={current:t};return{get(e){return r.current[e]},set(e,o){r.current[e]=o}}}const z=t=>typeof t=="function"?t():t,ht=(t,r)=>{let e=[],o=!0;U(()=>{if(o){e=t.map(c=>z(c)),o=!1;return}let i=!1;for(let c=0;c<t.length;c++)if(!st(e[c],z(t[c]))){i=!0;break}i&&(e=t.map(c=>z(c)),r())})};function P(t){return w(t)?t():t}function kt(t,r){const e=V(()=>{const{id:n,ids:s,getRootNode:f}=P(r);return at({id:n,ids:s,getRootNode:f})}),o=(...n)=>{t.debug&&console.log(...n)},i=V(()=>t.props?.({props:it(P(r)),scope:g(e)})??P(r)),c=xt(()=>g(i)),p=t.context?.({prop:c,bindable:$,get scope(){return g(e)},flush:B,getContext(){return b},getComputed(){return k},getRefs(){return R},getEvent(){return N()}}),b={get(n){return p?.[n].get()},set(n,s){p?.[n].set(s)},initial(n){return p?.[n].initial},hash(n){const s=p?.[n].get();return p?.[n].hash(s)}};let m=new Map,a={current:null},d={current:null},y={current:{type:""}};const N=()=>({...y.current,current(){return y.current},previous(){return d.current}}),_=()=>({...x,hasTag(n){const s=x.get();return!!t.states[s]?.tags?.includes(n)},matches(...n){const s=x.get();return n.includes(s)}}),R=yt(t.refs?.({prop:c,context:b})??{}),h=()=>({state:_(),context:b,event:N(),prop:c,send:T,action:v,guard:j,track:ht,refs:R,computed:k,flush:B,scope:g(e),choose:F}),v=n=>{const s=w(n)?n(h()):n;if(!s)return;const f=s.map(u=>{const l=t.implementations?.actions?.[u];return l||D(`[zag-js] No implementation found for action "${JSON.stringify(u)}"`),l});for(const u of f)u?.(h())},j=n=>w(n)?n(h()):t.implementations?.guards?.[n](h()),A=n=>{const s=w(n)?n(h()):n;if(!s)return;const f=s.map(l=>{const S=t.implementations?.effects?.[l];return S||D(`[zag-js] No implementation found for effect "${JSON.stringify(l)}"`),S}),u=[];for(const l of f){const S=l?.(h());S&&u.push(S)}return()=>u.forEach(l=>l?.())},F=n=>ct(n).find(s=>{let f=!s.guard;return ut(s.guard)?f=!!j(s.guard):w(s.guard)&&(f=s.guard(h())),f}),k=n=>{ot(t.computed,()=>"[zag-js] No computed object found on machine");const s=t.computed[n];return s({context:b,event:N(),prop:c,refs:R,scope:g(e),computed:k})},x=$(()=>({defaultValue:t.initialState({prop:c}),onChange(n,s){s&&(m.get(s)?.(),m.delete(s)),s&&v(t.states[s]?.exit),v(a.current?.actions);const f=A(t.states[n]?.effects);if(f&&m.set(n,f),s===M){v(t.entry);const u=A(t.effects);u&&m.set(M,u)}v(t.states[n]?.entry)}}));let C=E.NotStarted;tt(()=>{const n=C===E.Started;C=E.Started,o(n?"rehydrating...":"initializing..."),x.invoke(x.initial,M)}),I(()=>{o("unmounting..."),C=E.Stopped,m.forEach(n=>n?.()),m=new Map,a.current=null,v(t.exit)});const T=n=>{if(C!==E.Started)return;d.current=y.current,y.current=n;let s=x.get();const f=t.states[s].on?.[n.type]??t.on?.[n.type],u=F(f);if(!u)return;a.current=u;const l=u.target??s;o("transition",n.type,u.target||s,`(${u.actions})`);const S=l!==s;S?x.set(l):u.reenter&&!S?x.invoke(s,s):v(u.actions)};return t.watch?.(h()),{get state(){return _()},send:T,context:b,prop:c,get scope(){return g(e)},refs:R,computed:k,get event(){return N()},getStatus:()=>C}}function xt(t){return function(e){return t()[e]}}function B(t){L(()=>{queueMicrotask(()=>t())})}export{Et as a,Ct as c,Rt as m,Nt as n,wt as s,kt as u};
